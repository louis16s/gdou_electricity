# `electric_requests.py` 使用说明

`electric_requests.py` 是一个使用 Python `requests` 库实现的广东海洋大学电费查询脚本。脚本会自动登录智慧能源平台，刷新电表抄表数据，并可将成功或失败结果通过 [Bark](https://github.com/Finb/Bark) 推送到手机。

## 功能特点
- 以学工账号登录并验证身份。
- 调用内部接口换取应用访问 `token`。
- 查询宿舍电表信息并执行一次远程抄表刷新。
- 输出最新电量、电费、更新时间等关键信息。
- 可选地向 Bark 推送成功或失败通知。

## 环境要求
- Python 3.9+
- 网络可以访问 `https://cz.gdou.edu.cn` 与 `https://api.day.app`

### 依赖库
脚本仅依赖于标准库和第三方库 `requests`。推荐额外安装 `rich` 以便在终端输出彩色信息（需要自行在脚本中加入 `rich` 相关代码）。

```bash
pip install requests
```

## 使用前准备
1. **填写学生信息**：在脚本顶部的配置区填入以下内容：
   - `STUDENT_NAME`
   - `STUDENT_OUTID`（学工号/一卡通账号）
   - `STUDENT_PWD`
2. **配置 Bark 推送（可选）**：
   - 建议在运行环境中设置 `BARK_TOKEN` 环境变量。
   - 也可以直接修改 `DEFAULT_BARK_TOKEN` 常量。

## 运行方式
```bash
python electric_requests.py
```
脚本将按以下步骤执行：
1. 登录账号，打印返回的登录结果。
2. 获取电力系统访问 `token`。
3. 根据学号查询宿舍电表信息。
4. 调用刷新接口强制抄表。
5. 获取刷新后的电表状态，并在终端逐项打印。
6. 若配置了 Bark，会推送带有余额、总电量和更新时间的通知。

> 提示：脚本默认关闭了 HTTPS 证书告警，因为校园网络常使用自签证书。若在公网环境使用，可考虑移除此行为并提供合法证书。

## 定时运行（可选）
若需定期查询并推送，可以结合以下方案：
- Linux/macOS：使用 `cron`，例如每小时执行一次。
- Windows：使用「任务计划程序」。
- 自建服务：将脚本放入长期运行的容器或云函数。

示例 `cron` 条目（每两小时运行一次）：
```
0 */2 * * * /usr/bin/python3 /path/to/electric_requests.py >> /var/log/gdou_electricity.log 2>&1
```

## 故障排查
- **登录失败**：核对学号/密码是否正确，或检查是否需要更新脚本参数。
- **请求超时**：确认校园网或代理是否可访问目标接口，并适当增大 `timeout`。
- **Bark 未推送**：确保环境变量或默认 Token 正确，且 Bark 应用未被系统限制通知。

## 安全建议
- 切勿将学号密码写入公共仓库。
- 如果脚本部署在服务器上，建议通过环境变量注入凭据。
- 定期更换 Bark Token，并避免日志中泄露个人信息。

## 许可
项目继承仓库原有许可协议，如需二次分发，请遵守原作者的开源条款。
